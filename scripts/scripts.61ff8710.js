"use strict";function CompleteProfileCtrl(a,b,c,d){a.authUser=c,a.submitting=!1;var e=function(){b.go("main.dashboard")};a.submit=function(){return image&&""!=image?(a.submitting=!0,void a.user.$update(e)):void(a.errors="You have to upload image")},a.openFileManager=function(){var b={fileTypes:["image"]};d.open(b).then(function(b){a.image=b[0].url})}}function DashboardCtrl(a,b,c,d){a.page.title="Dashboard",d.query({role:"team"}).$promise.then(function(b){a.teamProjects=b}),d.query({role:"creator"}).$promise.then(function(b){a.createdProjects=b}),d.query({role:"approver"}).$promise.then(function(b){a.approvedProjects=b})}function LoginCtrl(a,b,c){var d=function(){c.go("main.dashboard")},e=function(b){console.log(b),a.errors=b.plainMessage()};a.loginUser=function(a){b.login(a).$promise.then(d).catch(e)}}function MainCtrl(a,b,c){a.openFileManager=function(){var a={fileTypes:["image"]};c.open(a).then(function(a){b.profile_image=a[0].url,b.$update()})},a.page={title:""},a.default={profile_image:"http://assets3.stag-br-app-s5.brenv.net/images/redesign/avatars/default-user-icon-profile.png?1410309050"},a.authUser=b,a.dropdown={notifications:[{text:"Show All notifications",href:"#/notifications"}],users:[{text:"Show All users",href:"#/users"}]};a.toggleSideMenu=function(){$(".inner-container").toggleClass("side-closed")},a.toggleSubmenu=function(a){$(a.currentTarget).toggleClass("menu-opened")},a.hasPermission=function(b,c){return a.authUser.hasPermission(b,c)}}function ProfileCtrl(a){a.page.title="Profile page"}function RegisterCtrl(a,b,c,d,e,f){a.user=new b;var g=function(b){a.errors=b.plainMessage(),a.submitting=!1},h=function(b){return a.submitting=!1,b},i=function(a){return f.sendEmail(a.email)},j=function(){var a={description:"An email has send with information to validate your account.",status:"success"};e.open("message",{message:a})},k=function(){d.go("login")};a.submit=function(b){a.submitting=!0,b.$register().then(h).then(i).then(j).then(k).catch(g)}}function ProjectsAllCtrl(a,b,c){a.projects=b;var d=function(b){for(var c=a.projects.length-1;c>=0;c--)if(a.projects[c].id==b.id)return c;return-1};a.deleteProject=function(b){var e=d(b);e>-1&&a.projects.splice(e,1),b.$delete().then(function(){c.success("Project deleted successfully")})}}function ProjectsCreateCtrl(a,b,c,d){a.page.title="Create project",a.project=new b;var e=function(b){c.success("Project created successfully"),a.hasPermission("projects","update")?d.go("main.projects.edit",b):d.go("main.dashboard")},f=function(a){c.error(a.plainMessage())};a.submit=function(a){a.$save().then(e).catch(f)}}function ProjectsEditCtrl(a,b,c,d,e){a.page.title="Edit project "+b.name,a.project=b,a.users=c;var f=function(a,b){void 0===a.team&&(a.team=[]);for(var c=a.team.length-1;c>=0;c--)if(a.team[c].id==b.id)return c;return-1};a.toggleUser=function(a,b){this.isUserSelected(a,b)?a.team.splice(f(a,b),1):a.team.push(b)},a.isUserSelected=function(a,b){return f(a,b)>-1};var g=function(){d.success("Project has been saved successfully")},h=function(a){d.error(a.plainMessage())},i=function(){e.go("main.projects.show",a.project)};a.submit=function(a){a.$update().then(g).then(i).catch(h)}}function ProjectsMainCtrl(a,b){a.addStage=function(a){void 0===a.stages&&(a.stages=[]),a.stages.push({notes:"",end_date:""})},a.removeStage=function(a,b){a.stages.splice(b,1)},a.attachFiles=function(a){var c={multipleFiles:!0};b.open(c).then(function(b){void 0===a.files&&(a.files=[]),a.files=a.files.concat(b)})},a.removeFile=function(a,b){a.files.splice(b,1)},a.getFilename=function(a){return a.url.substring(a.url.lastIndexOf("/")+1)},a.getFileIcon=function(a){switch(a.type){case"image":return"fa fa-photo";case"pdf":return"fa fa-file-pdf-o";case"image":return"fa fa-file-word-o"}}}function ProjectsShowCtrl(a,b,c,d,e){a.page.title="Project "+b.name,a.project=b,a.comments=c;var f=function(){a.comment=new d,a.comment.project_id=a.project.id},g=function(a){e.error(a.plainMessage())};a.addComment=function(b){b.$save().then(function(b){a.comments.push(b)}).then(f).catch(g)},f()}function DepartmentsMainCtrl(){}function DepartmentsAllCtrl(a,b){a.departments=b}function DepartmentsCreateCtrl(a,b,c,d){a.page.title="Create department",a.department=new b;var e=function(a){d.go("main.departments.edit",a)},f=function(a){c.error(a.plainMessage())};a.submit=function(a){a.$save().then(e).catch(f)}}function DepartmentsEditCtrl(a,b,c,d,e,f){var g=function(a,b){void 0===a.users&&(a.users=[]);for(var c=a.users.length-1;c>=0;c--)if(a.users[c].id==b.id)return c;return-1};a.toggleUser=function(a,b){this.isUserSelected(a,b)?a.users.splice(g(a,b),1):a.users.push(b)},a.isUserSelected=function(a,b){return g(a,b)>-1};var h=function(){e.success("Department has been saved successfully")},i=function(a){e.error(a.plainMessage())},j=function(){f.go("main.departments.show",a.department)};a.submit=function(a){console.log(a.users),a.$update().then(h).then(j).catch(i)},a.toggleSelection=function(b){void 0===a.department.permissions&&(a.department.permissions=[]),a.isPermissionSelected(b)?a.deletePermission(b):a.addPermission(b)},a.isPermissionSelected=function(b){return a.getPermissionIndex(b)>-1},a.deletePermission=function(b){a.department.permissions.splice(a.getPermissionIndex(b),1)},a.addPermission=function(b){a.department.permissions.push(b)},a.getPermissionIndex=function(b){for(var c=a.department.permissions.length-1;c>=0;c--)if(a.department.permissions[c].name==b.name)return c;return-1};var k=function(a,b){for(var c=a.length-1;c>=0;c--)for(var d=b.length-1;d>=0;d--)b[d].name==a[c].name&&(b[d].id=a[c].id)};a.page.title="Edit department "+b.name,a.department=b,a.permissions=d,a.users=c,void 0!==a.department.permissions&&k(a.department.permissions,a.permissions)}function DepartmentsShowCtrl(a,b,c,d){var e=function(a,b){for(var c=a.permissions.length-1;c>=0;c--)for(var d=b.length-1;d>=0;d--)b[d].name==a.permissions[c].name&&(a.permissions[c].description=b[d].description)};a.page.title="Department "+b.name,a.department=b,a.department.users=c,e(a.department,d)}function UsersMainCtrl(){}function UsersAllCtrl(a,b){a.users=b}function UsersShowCtrl(a,b,c,d){a.user=b,a.acceptUser=function(a){d.accept(a).$promise.then(function(){a.active=1,c.success("User now can access firstchoice application")}).catch(function(a){c.error(a.plainMessage())})},a.refuseUser=function(a){d.refuse(a).$promise.then(function(){a.active=0,c.success("User now is blocked from accessing firstchoice application")}).catch(function(a){c.error(a.plainMessage())})}}angular.module("bmsApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ui.router","mgcrea.ngStrap","gridster","wu.masonry","angularFileUpload"]).config(["$datepickerProvider","$httpProvider",function(a,b){b.defaults.withCredentials=!0,angular.extend(a.defaults,{startView:1,dateFormat:"mediumDate"})}]).run(["$rootScope","$state","Alert","LocationHistory",function(a,b,c,d){a.globals=window.globals,a.$on("$stateChangeError",function(d,e,f,g,h,i){void 0!==i.isNotFound&&i.isNotFound()?b.go("errors.notfound"):void 0!==i.isUnauthorized&&i.isUnauthorized()?b.go("login"):void 0!==i.isForbidden&&i.isForbidden()?c.error(i.plainMessage()):void 0!==i.isInternalServer&&i.isInternalServer()?b.go("errors.server"):c.error(i),a.loadingView=!1}),a.$on("$stateChangeStart",function(b,c,e,f){d.add(f.url),a.loadingView=!0}),a.$on("$stateChangeSuccess",function(){a.loadingView=!1})}]),window.globals={environment:document.URL.indexOf("firstchoice.cc")>-1?"production":"development"},window.views={get:function(a){return a.indexOf(".html")<0&&(a+=".html"),"/views/"+a}},angular.module("bmsApp").run(["$rootScope",function(a){a.views=window.views}]).constant("environment",window.globals.environment),angular.module("bmsApp").config(["$urlRouterProvider","$stateProvider","$httpProvider","$locationProvider","$modalProvider",function(a,b,c,d,e){angular.extend(e.defaults,{placement:"center",sort:!1}),c.interceptors.push("ResponseInterceptor"),a.otherwise("/dashboard"),b.state("main",{templateUrl:window.views.get("main.html"),controller:"MainCtrl","abstract":!0,resolve:MainCtrl.resolve}).state("main.dashboard",{url:"/dashboard",templateUrl:window.views.get("pages/dashboard.html"),controller:"DashboardCtrl",resolve:DashboardCtrl.resolve}).state("main.profile",{url:"/profile",templateUrl:window.views.get("pages/profile.html"),controller:"ProfileCtrl",resolve:ProfileCtrl.resolve}).state("complete-profile",{url:"/complete-profile",templateUrl:window.views.get("pages/complete-profile.html"),controller:"CompleteProfileCtrl",resolve:ProfileCtrl.resolve}).state("login",{url:"/login",templateUrl:window.views.get("pages/login.html"),controller:"LoginCtrl"}).state("register",{url:"/register",templateUrl:window.views.get("pages/register.html"),controller:"RegisterCtrl"}).state("errors",{url:"/error",templateUrl:window.views.get("pages/errors/main.html")}).state("errors.notfound",{url:"/404",templateUrl:window.views.get("pages/errors/notfound.html")}).state("errors.noaccess",{url:"/noaccess",templateUrl:window.views.get("pages/errors/noaccess.html")}).state("errors.server",{url:"/server",templateUrl:window.views.get("pages/errors/server.html"),controller:"ServerErrorCtrl"}).state("main.projects",{url:"/projects",templateUrl:window.views.get("projects/main.html"),controller:"ProjectsMainCtrl",resolve:ProjectsMainCtrl.resolve}).state("main.projects.all",{url:"/",templateUrl:window.views.get("projects/all.html"),controller:"ProjectsAllCtrl",resolve:ProjectsAllCtrl.resolve}).state("main.projects.create",{url:"/create",templateUrl:window.views.get("projects/create.html"),controller:"ProjectsCreateCtrl",resolve:ProjectsCreateCtrl.resolve}).state("main.projects.edit",{url:"/edit/:id",templateUrl:window.views.get("projects/edit.html"),controller:"ProjectsEditCtrl",resolve:ProjectsEditCtrl.resolve}).state("main.projects.show",{url:"/show/:id",templateUrl:window.views.get("projects/show.html"),controller:"ProjectsShowCtrl",resolve:ProjectsShowCtrl.resolve}).state("main.departments",{url:"/departments",templateUrl:window.views.get("departments/main.html"),controller:"DepartmentsMainCtrl",resolve:DepartmentsMainCtrl.resolve}).state("main.departments.all",{url:"/",templateUrl:window.views.get("departments/all.html"),controller:"DepartmentsAllCtrl",resolve:DepartmentsAllCtrl.resolve}).state("main.departments.create",{url:"/create",templateUrl:window.views.get("departments/create.html"),controller:"DepartmentsCreateCtrl",resolve:DepartmentsCreateCtrl.resolve}).state("main.departments.edit",{url:"/edit/:id",templateUrl:window.views.get("departments/edit.html"),controller:"DepartmentsEditCtrl",resolve:DepartmentsEditCtrl.resolve}).state("main.departments.show",{url:"/show/:id",templateUrl:window.views.get("departments/show.html"),controller:"DepartmentsShowCtrl",resolve:DepartmentsShowCtrl.resolve}).state("main.users",{url:"/users",templateUrl:window.views.get("users/main.html"),controller:"UsersMainCtrl",resolve:UsersMainCtrl.resolve}).state("main.users.all",{url:"/",templateUrl:window.views.get("users/all.html"),controller:"UsersAllCtrl",resolve:UsersAllCtrl.resolve}).state("main.users.show",{url:"/show/:id",templateUrl:window.views.get("users/show.html"),controller:"UsersShowCtrl",resolve:UsersShowCtrl.resolve})}]),angular.module("bmsApp").directive("fallbackSrc",function(){return{restrict:"A",scope:{ngSrc:"@"},link:function(a,b,c){a.$watch("ngSrc",function(a){""===a&&angular.element(b).attr("src",c.fallbackSrc)}),b.bind("error",function(){angular.element(this).attr("src",c.fallbackSrc)})}}}),angular.module("bmsApp").directive("imagedrop",["$parse","ImageDrop",function(a,b){return{restrict:"EA",link:function(){var a=function(a){a.preventDefault(),$("body").addClass("dragOver"),$("body").removeClass("dragEnd")},c=function(a){a.preventDefault(),$("body").addClass("dragEnd"),$("body").removeClass("dragOver")},d=function(a){b.callListener(a)};$(document).bind("dragover",a),$(document).bind("dragleave",c).bind("drop",function(a){c(a),d(a.originalEvent.dataTransfer.files[0])})}}}]),angular.module("bmsApp").factory("Alert",["$alert",function(a){var b=function(b,c,d,e){a({title:b,content:c,type:d,placement:"top-right",show:!0,duration:void 0===e?3:e})};return{success:function(a,c){b("Success",a,"success",c)},error:function(a,c){b("Error",a,"danger",c)},warning:function(a,c){b("Warning",a,"warning",c)},info:function(a,c){b("Info",a,"info",c)}}}]),angular.module("bmsApp").factory("Api",["environment",function(a){var b={"firstchoice.bms.v1":{url:function(a){return"http://firstchoice.dev/bms/api/v1/"+a}},"firstchoice.shared.v1":{url:function(a){return"http://firstchoice.dev/shared/api/v1/"+a}}},c={"firstchoice.bms.v1":{url:function(a){return"http://site.firstchoice.cc/bms/api/v1/"+a}},"firstchoice.shared.v1":{url:function(a){return"http://site.firstchoice.cc/shared/api/v1/"+a}}};return{use:function(d){return"production"==a?c[d]:b[d]}}}]),angular.module("bmsApp").factory("Department",["$resource","Api",function(a,b){var c=b.use("firstchoice.shared.v1"),d={update:{method:"PUT"}};return a(c.url("department/:id"),{id:"@id"},d)}]),angular.module("bmsApp").factory("Drive",["$resource","Api",function(a,b){var c=b.use("firstchoice.shared.v1"),d={update:{method:"PUT"},main:{method:"GET",url:c.url("drive/main")}};return a(c.url("drive/:id"),{id:"@id"},d)}]),angular.module("bmsApp").factory("FileManager",["Modal","$q",function(a,b){var c=null,d=[],e={multipleFiles:!1,uploadMethods:["computer","drag-and-drop"],fileTypes:["image","doc","pdf"]},f=function(a){for(var b=d.length-1;b>=0;b--)if(angular.equals(d[b],a))return b;return-1},g={deferred:null,open:function(c){return this.setConfiguration(c),a.open("drive"),a.listen("drive","hide.before").then(g.deselectAll),this.deferred=b.defer(),this.deferred.promise},close:function(){a.close()},finish:function(){this.deferred.resolve(angular.copy(d)),this.close()},setConfiguration:function(a){c=angular.extend(e,a)},getConfigurations:function(){return c},selectFile:function(a){d.push(a)},deselectFile:function(a){var b=f(a);b>-1&&d.splice(b,1)},isFileSelected:function(a){return f(a)>-1},countSelectedFiles:function(){return d.length},deselectAll:function(){d=[]},isMultipleFilesEnabled:function(){return c.multipleFiles},getUploadMethods:function(){return c.uploadMethods},getFileTypes:function(){return c.fileTypes},onlyImages:function(){return 1==c.fileTypes.length&&"image"==c.fileTypes[0]}};return g}]),angular.module("bmsApp").factory("FileUpload",["Api","$upload","$q","ResponseError",function(a,b,c,d){var e=a.use("firstchoice.shared.v1"),f=function(a,e){var f=c.defer();return b.upload({url:a,method:"POST",file:e}).progress(function(a){f.notify(parseInt(100*a.loaded/a.total))}).success(function(a){f.resolve(a)}).error(function(a,b,c){f.reject(d.instance(a,b,c))}),f.promise};return{toDrive:function(a,b){return f(e.url("drive/"+a.id+"/file"),b)}}}]),angular.module("bmsApp").factory("File",["$resource","Api",function(a,b){var c=b.use("firstchoice.shared.v1");return a(c.url("drive/:driveId/file/:fileId"),{fileId:"@id"})}]),angular.module("bmsApp").factory("Helpers",function(){return{type:{promise:function(a){return angular.isObject(a)&&angular.isObject(a.promise)&&a.promise.then instanceof Function&&a.promise["catch"]instanceof Function&&a.promise["finally"]instanceof Function},array:function(a){return a instanceof Array},glob:function(a){return a.indexOf("*")>-1}},string:{getLocation:function(a){var b=document.createElement("a");return b.href=a,b},rtrim:function(a,b){b=b||"\\s",a.replace(new RegExp("["+b+"]+$","g"),"")},ltrim:function(a,b){b=b||"\\s",a.replace(new RegExp("^["+b+"]+","g"),"")},trim:function(a,b){return this.ltrim(this.rtrim(a,b),b)},ucfirst:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},slugify:function(a){return a&&a.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}},glob:{match:function(a,b){var c=a.split("."),d=b.split(".");if("**"===c[0]&&(d=d.slice(d.indexOf(c[1])),d.unshift("**")),"**"===c[c.length-1]&&(d.splice(d.indexOf(c[c.length-2])+1,Number.MAX_VALUE),d.push("**")),c.length!=d.length)return!1;for(var e=0,f=c.length;f>e;e++)"*"===c[e]&&(d[e]="*");return d.join("")===c.join("")}}}}),angular.module("bmsApp").factory("ImageDrop",["$rootScope",function(a){var b=[];a.$on("$stateChangeStart",function(){b=[]});var c={addListener:function(a){b.push(a)},getListener:function(){return b[b.length-1]},popListener:function(){b.pop()},callListener:function(a){b.length>0&&this.getListener()(a)}};return c}]),angular.module("bmsApp").factory("LocationHistory",["$location",function(a){var b=[];return{add:function(a){b.push(a)},back:function(){a.url(this.previousUrl())},previousUrl:function(){return b.length>0?b[b.length-1]:""}}}]),angular.module("bmsApp").factory("Modal",["$modal","$rootScope","$q",function(a,b,c){var d=null,e=function(a){return window.views.get("modals/"+a+".html")},f=function(a){return a+"Modal"};return{open:function(g,h,i){this.close();var j=c.defer(),k={template:e(g),scope:b.$new(!0),prefixEvent:f(g)};return k.scope.data=h,k.scope.deferred=j,k=angular.extend(k,i),d=a(k),j.promise},close:function(){null!=d&&"function"==typeof d.hide&&d.hide()},listen:function(a,d){var e=c.defer(),g=f(a)+"."+d;return b.$on(g,function(a){e.resolve(a)}),e.promise}}}]),angular.module("bmsApp").factory("Notification",["$resource","Api",function(a,b){var c=b.use("firstchoice.shared.v1"),d={update:{method:"PUT"}};return a(c.url("notification/:id"),{id:"@id"},d)}]),angular.module("bmsApp").factory("ProjectComment",["$resource","Api",function(a,b){var c=b.use("firstchoice.bms.v1"),d={update:{method:"PUT"}};return a(c.url("project/:project_id/comment/:comment_id"),{commentId:"@id",project_id:"@project_id"},d)}]),angular.module("bmsApp").factory("Project",["$resource","Api",function(a,b){var c=b.use("firstchoice.bms.v1"),d={update:{method:"PUT"},accept:{method:"PUT",url:c.url("project/accept/:projectId")},refuse:{method:"PUT",url:c.url("project/refuse/:projectId")}};return a(c.url("project/:id"),{id:"@id"},d)}]),angular.module("bmsApp").factory("Permission",["$http","Api",function(a,b){var c=b.use("firstchoice.shared.v1");return{all:function(){return a.get(c.url("permission/bms")).then(function(a){return a.data})}}}]),angular.module("bmsApp").factory("ResponseError",function(){var a=function(a,b,c){this.data=a,this.status=b,this.headers=c,this.messages=function(){return a},this.plainMessage=function(b){if(this.isInternalServer())return"Internal server error";b=void 0===b?"<br/>":b;var c="";for(var d in a)c+=a[d]instanceof Array?a[d].join(b)+b:a[d]+b;return c},this.isValidation=function(){return"validation"==this.getType()},this.isUnauthorized=function(){return"unauthorized"==this.getType()},this.isForbidden=function(){return"forbidden"==this.getType()},this.isNotFound=function(){return"notfound"==this.getType()},this.isInternalServer=function(){return"internal_server"==this.getType()},this.isNotKnown=function(){return"unknown"==this.getType()},this.getType=function(){switch(b){case 400:return"validation";case 401:return"unauthorized";case 403:return"forbidden";case 404:return"notfound";case 500:return"internal_server";default:return"unknown"}}};return{instance:function(b,c,d){return new a(b,c,d)}}}),angular.module("bmsApp").factory("ResponseInterceptor",["$q","ResponseError",function(a,b){return{response:function(b){return b||a.when(b)},responseError:function(c){return a.reject(b.instance(c.data,c.status,c.headers))}}}]),angular.module("bmsApp").factory("Session",["$resource","Api",function(a,b){var c=b.use("firstchoice.shared.v1"),d={login:{method:"POST",url:c.url("session/login")},logout:{method:"GET",url:c.url("session/logout")}};return a(c.url("session"),{},d)}]),angular.module("bmsApp").factory("StatusModal",["Modal","$q",function(a,b){var c;return{init:function(){c=[]},add:function(a,d){var e={promise:a,description:d,resolved:!1};a instanceof Array?b.all(a).then(function(){e.resolved=!0}):a.then(function(){e.resolved=!0}),c.push(e)},afterAll:function(){for(var a=[],d=c.length-1;d>=0;d--)a.push(c[d].promise);return b.all(a)},open:function(){return a.open("status",{allStatus:c})}}}]),angular.module("bmsApp").factory("User",["$resource","Api",function(a,b){var c=b.use("firstchoice.shared.v1"),d={update:{method:"PUT"},accept:{method:"PUT",url:c.url("user/accept/:id")},register:{method:"POST",url:c.url("user/register")},session:{method:"GET",url:c.url("user/session")},refuse:{method:"PUT",url:c.url("user/refuse/:id")}},e=a(c.url("user/:id"),{id:"@id"},d);return e.prototype.hasPermission=function(a,b){var c=this.getPermissions();if(void 0===c)return!1;for(var d=c.length-1;d>=0;d--){var e=c[d].name.split("."),f=e[0]==a&&(void 0===b||e[1]==b||"*"==e[1]);if(f)return!0}return!1},e.prototype.getPermissions=function(){return this.permissions},e.prototype.hasCompletedProfile=function(){return""!=this.profile_image},e}]),angular.module("bmsApp").factory("UserEmailValidation",["$http","Api",function(a,b){var c=b.use("firstchoice.shared.v1");return{sendEmail:function(b){return a.post(c.url("email-validation/send-email"),{email:b})}}}]),CompleteProfileCtrl.$inject=["$scope","$state","authUser","FileManager"],CompleteProfileCtrl.resolve={authUser:["User",function(a){return a.session().$promise}]},angular.module("bmsApp").controller("CompleteProfileCtrl",CompleteProfileCtrl),DashboardCtrl.$inject=["$scope","$upload","User","Project"],angular.module("bmsApp").controller("DashboardCtrl",DashboardCtrl),LoginCtrl.$inject=["$scope","Session","$state"],angular.module("bmsApp").controller("LoginCtrl",LoginCtrl),MainCtrl.$inject=["$scope","authUser","FileManager"],MainCtrl.resolve={authUser:["User",function(a){return a.session().$promise}]},angular.module("bmsApp").controller("MainCtrl",MainCtrl),ProfileCtrl.$inject=["$scope"],angular.module("bmsApp").controller("ProfileCtrl",ProfileCtrl),RegisterCtrl.$inject=["$scope","User","Department","$state","Modal","UserEmailValidation"],angular.module("bmsApp").controller("RegisterCtrl",RegisterCtrl),angular.module("bmsApp").controller("ServerErrorCtrl",["$scope","LocationHistory",function(a,b){a.tryAgain=function(){b.back()}}]),angular.module("bmsApp").controller("DriveFilesCtrl",["$scope","FileManager",function(a,b){a.query=b.onlyImages()?{type:"image"}:{}}]),angular.module("bmsApp").controller("DriveCtrl",["$scope","Drive","FileManager",function(a,b,c){a.isMultipleSelectEnabled=function(){return c.isMultipleFilesEnabled()},a.toggleSelection=function(b){c.isFileSelected(b)?c.deselectFile(b):c.selectFile(b),c.isMultipleFilesEnabled()||a.finishSelection()},a.selectAndFinish=function(b){c.isFileSelected(b)||c.selectFile(b),a.finishSelection()},a.countSelectedFiles=function(){return c.countSelectedFiles()},a.finishSelection=function(){c.finish()},a.deselectAll=function(){c.deselectAll()},a.isFileSelected=function(a){return c.isFileSelected(a)},a.tabs=[{title:"Upload",template:window.views.get("modals/drive/drive.upload.html")},{title:"Drive",template:window.views.get("modals/drive/drive.files.html")}],a.tabs.activeTab=0,a.changeMainTab=function(b){for(var c=0;c<a.tabs.length;c++)if(a.tabs[c].title.toUpperCase()==b.toUpperCase())return void(a.tabs.activeTab=c)},a.getMainTabTitle=function(b){return a.tabs[b].title},a.isActiveMainTab=function(b){return a.getMainTabTitle(a.tabs.activeTab).toLowerCase()==b.toLowerCase()},b.main().$promise.then(function(b){a.drive=b,void 0===a.drive.files&&(a.drive.files=[])}),a.cancel=function(){a.$hide()}}]),angular.module("bmsApp").controller("DriveUploadCtrl",["$scope","ImageDrop","FileUpload","FileManager","Alert",function(a,b,c,d){var e={view:"",showUploadingView:function(){this.view="uploading"},showUploaderView:function(){this.view="uploader"},showSuccessStatus:function(){this.view="success-status"},showErrorStatus:function(){this.view="error-status"},isSuccessStatus:function(){return"success-status"==this.view},isErrorStatus:function(){return"error-status"==this.view},isUploaderView:function(){return"uploader"==this.view},isUploadingView:function(){return"uploading"==this.view}};a.Tab=e;var f={progress:0,uploading:!1,onErrorListeners:[],onUploadListeners:[],methods:[],drive:null,multipleFiles:!1,init:function(a,b,c){f.methods=a,f.drive=b,f.multipleFiles=c},reset:function(){f.progress=0,f.uploading=!1},inProgress:function(a){f.progress=a},uploadSucceed:function(a){f.callOnUploadListeners(a),f.reset()},uploadFailed:function(a){f.callOnErrorListeners(a),f.reset()},uploadFiles:function(a){e.showUploadingView(),f.uploading=!0,c.toDrive(f.drive,a[0]).then(f.uploadSucceed,f.uploadFailed,f.inProgress)},isUploading:function(){return f.uploading},onUpload:function(a){f.onUploadListeners.push(a)},onError:function(a){f.onErrorListeners.push(a)},callOnUploadListeners:function(a){for(var b=f.onUploadListeners.length-1;b>=0;b--)f.onUploadListeners[b](a)},callOnErrorListeners:function(a){for(var b=f.onErrorListeners.length-1;b>=0;b--)f.onErrorListeners[b](a)},getMethods:function(){return f.methods},hasMethod:function(a){return f.getMethods().indexOf(a)>-1},getProgress:function(){return f.progress},getProgressStyle:function(){return{width:f.progress+"%"}},hasComputerMethod:function(){return f.hasMethod("computer")},hasDropMethod:function(){return f.hasMethod("drag-and-drop")},isMultipleFiles:function(){return this.multipleFiles}};a.Uploader=f;var g=function(){var b=!1;a.openFileDialog=function(){$("#hiddenFileUploader").trigger("click"),b||$("#hiddenFileUploader").on("change",function(){f.uploadFiles(this.files),a.$apply(),b=!0,$(this).val("")})}},h=function(){b.addListener(function(b){f.uploadFiles([b]),a.$apply()})},i=function(){f.onUpload(function(b){e.showSuccessStatus("Image uploaded successfully"),a.drive.files.push(b),a.lastUploadedFile=b}),f.onError(function(a){console.log(a),e.showErrorStatus(a)})},j=function(b){a.drive=b,f.init(d.getUploadMethods(),b,d.isMultipleFilesEnabled()),f.hasComputerMethod()&&g(),f.hasDropMethod()&&h(),i(),e.showUploaderView()};a.$watch("drive",function(a){a&&j(a)}),e.showUploaderView()}]),angular.module("bmsApp").controller("ModalMessageCtrl",["$scope",function(a){a.message=a.data.message,a.isSuccessStatus=function(){return"success"==a.message.status},a.isErrorStatus=function(){return"error"==a.message.status}}]),angular.module("bmsApp").controller("ModalStatusCtrl",["$scope","StatusModal","$interval",function(a,b,c){a.allStatus=a.data.allStatus,a.getStatusIcon=function(a){return a.resolved?"fa fa-check-circle":"fa fa-spinner fa-spin"};var d=function(){c(function(){a.deferred.resolve(),a.$hide()},2e3)};b.afterAll().then(d)}]),ProjectsAllCtrl.$inject=["$scope","projects","Alert"],ProjectsAllCtrl.resolve={projects:["Project",function(a){return a.query().$promise}]},angular.module("bmsApp").controller("ProjectsAllCtrl",ProjectsAllCtrl),ProjectsCreateCtrl.$inject=["$scope","Project","Alert","$state"],angular.module("bmsApp").controller("ProjectsCreateCtrl",ProjectsCreateCtrl),ProjectsEditCtrl.$inject=["$scope","project","users","Alert","$state"],ProjectsEditCtrl.resolve={project:["Project","$stateParams",function(a,b){return a.get({id:b.id}).$promise}],users:["User",function(a){return a.query().$promise}]},angular.module("bmsApp").controller("ProjectsEditCtrl",ProjectsEditCtrl),ProjectsMainCtrl.$inject=["$scope","FileManager","Alert"],angular.module("bmsApp").controller("ProjectsMainCtrl",ProjectsMainCtrl),ProjectsShowCtrl.$inject=["$scope","project","comments","ProjectComment","Alert"],ProjectsShowCtrl.resolve={project:["Project","$stateParams",function(a,b){return a.get({id:b.id}).$promise}],comments:["ProjectComment","$stateParams",function(a,b){return a.query({project_id:b.id}).$promise}]},angular.module("bmsApp").controller("ProjectsShowCtrl",ProjectsShowCtrl),DepartmentsMainCtrl.$inject=["$scope","FileManager"],angular.module("bmsApp").controller("DepartmentsMainCtrl",DepartmentsMainCtrl),DepartmentsAllCtrl.$inject=["$scope","departments"],DepartmentsAllCtrl.resolve={departments:["Department",function(a){return a.query().$promise}]},angular.module("bmsApp").controller("DepartmentsAllCtrl",DepartmentsAllCtrl),DepartmentsCreateCtrl.$inject=["$scope","Department","Alert","$state"],angular.module("bmsApp").controller("DepartmentsCreateCtrl",DepartmentsCreateCtrl),DepartmentsEditCtrl.$inject=["$scope","department","users","permissions","Alert","$state"],DepartmentsEditCtrl.resolve={department:["Department","$stateParams",function(a,b){return a.get({id:b.id}).$promise}],users:["User",function(a){return a.query().$promise}],permissions:["Permission",function(a){return a.all()}]},angular.module("bmsApp").controller("DepartmentsEditCtrl",DepartmentsEditCtrl),DepartmentsShowCtrl.$inject=["$scope","department","users","permissions"],DepartmentsShowCtrl.resolve={department:["Department","$stateParams",function(a,b){return a.get({id:b.id}).$promise}],users:["User","department",function(a,b){return a.query({department_id:b.id}).$promise}],permissions:["Permission",function(a){return a.all()}]},angular.module("bmsApp").controller("DepartmentsShowCtrl",DepartmentsShowCtrl),angular.module("bmsApp").controller("UsersMainCtrl",UsersMainCtrl),UsersAllCtrl.$inject=["$scope","users"],UsersAllCtrl.resolve={users:["User",function(a){return a.query({with_inactive:!0}).$promise}]},angular.module("bmsApp").controller("UsersAllCtrl",UsersAllCtrl),UsersShowCtrl.$inject=["$scope","user","Alert","User"],UsersShowCtrl.resolve={user:["User","$stateParams","$q",function(a,b){return a.get({id:b.id}).$promise}]},angular.module("bmsApp").controller("UsersShowCtrl",UsersShowCtrl);